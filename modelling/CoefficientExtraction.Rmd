---
title: "Group A & B Model Fits - GLMM - Coefficient Extraction"
output: html_notebook
  
---

This notebook fits the GLMM models to immune outcomes in Group A and B. It extracts coefficient estimates and their standard errors (as well as 95% confidence intervals) for outcome selection. Model checking is performed in a separate notebook.

```{r setup, include = FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

setwd("C:/Users/HLCSH/OneDrive/Documents/MSc 2023-2024/MSc Dissertation/MScDissertationCodeBase")

# Load packages
library(readxl)
library(tidyverse)
library(ggplot2)
library(reshape2)
library(glmmTMB)
library(MASS)
library(DHARMa)
options(scipen = 999)

# Read in group data

groupA = read_xlsx("data/groupAinfantsData_AD_23Feb2023.xlsx")
varA = colnames(groupA[, 17:56])

groupB = read_xlsx("data/groupBinfantsData_AD_23Feb2023.xlsx")
varB = colnames(groupB[, 16:34])

# Change variable names

## Study design and covariates

colnames(groupA)[1:4] = c("ID", "Group", "Time", "Treatment")
groupA$Time = as.factor(groupA$Time)
colnames(groupA)[10] = c("QFT")
colnames(groupA)[12:13] = c("Feeding", "Antibiotic")

colnames(groupB)[1:4] =  c("ID", "Group", "Time", "Treatment")
groupB$Time = as.factor(groupB$Time)
colnames(groupB)[10] = c("QFT")
colnames(groupB)[12:13] = c("Feeding", "Antibiotic")

# Create new dummy variables for feeding and antibiotic

groupA$FA = ifelse(groupA$Feeding == "Breast Milk" & groupA$Antibiotic == "Yes", 3, ifelse(groupA$Feeding == "Breast Milk" & groupA$Antibiotic == "No", 2, ifelse(groupA$Feeding == "Formula" & groupA$Antibiotic == "No", 1, 0)))
groupA$FA = factor(groupA$FA)

groupB$FA = ifelse(groupB$Feeding == "Breast Milk" & groupB$Antibiotic == "Y", 3, ifelse(groupB$Feeding == "Breast Milk" & groupB$Antibiotic == "N", 2, ifelse(groupB$Feeding == "Formula" & groupB$Antibiotic == "N", 1, 0)))
groupB$FA = factor(groupB$FA)

## Create immune response data sets

# Rename by number

groupA = rename_with(.data = groupA, .fn = ~ paste0("O", 1:length(varA)), .cols = 17:56)
groupB = rename_with(.data = groupB, .fn = ~ paste0("O", 1:length(varB)), .cols = 16:34)

# Drop indeterminate QFT observations
indet_idsA = groupA[which(groupA$QFT == "Indeterminate"), ]$ID
indet_idsB = groupB[which(groupB$QFT == "Indeterminate"), ]$ID

groupA = groupA[-which(groupA$ID %in% indet_idsA), ]
groupB = groupB[-which(groupB$ID %in% indet_idsB), ]

# Make time and variables of interest factors

colnam = c("Treatment", "Time", "Gender", "QFT", "FA")
groupA[colnam] = lapply(groupA[colnam], factor)
groupB[colnam] = lapply(groupB[colnam], factor)

# Set reference levels for Group A

groupA$Time = factor(groupA$Time, levels = c("112", "56", "365"))

# Divide Group B by time points and set reference levels

groupB1 = groupB[, -c(16:18, 23:34)]
groupB1 = groupB1[-which(groupB1$Time %in% c("63", "0", "56")), ]
groupB1$Time = factor(groupB1$Time, levels = c("112", "365"))

groupB2 = groupB[, -c(16:22)]
groupB2 = groupB2[-which(groupB2$Time %in% c("112", "0", "365")), ]
groupB2$Time = factor(groupB2$Time, levels = c("63", "56"))

# Relevel for coefficient extraction

groupAre1 = groupA
groupAre1$FA = factor(groupAre1$FA, levels = c(3, 0, 1, 2))
groupAre1[colnam] = lapply(groupAre1[colnam], factor)

groupB1re1 = groupB1
groupB1re1$FA = factor(groupB1re1$FA, levels = c(3, 0, 1, 2))
groupB1re1[colnam] = lapply(groupB1re1[colnam], factor)

groupB2re1 = groupB2
groupB2re1$FA = factor(groupB2re1$FA, levels = c(3, 0, 1, 2))
groupB2re1[colnam] = lapply(groupB2re1[colnam], factor)

sort_row_values = function(data) {
  
  # Ensure data is a data frame
  data = as.data.frame(data)
  
  # Swap values where LowerCI > UpperCI
  swap_indices = which(data$LowerCI > data$UpperCI)
  data[swap_indices, c("LowerCI", "UpperCI")] = data[swap_indices, c("UpperCI", "LowerCI")]
  
  return(data)
}



```
**%CD4+ ANYcytok+**:

```{r Outcome2, include=TRUE}
l = varA[2]
k = 2

# Fit models

## Treatment

AM_0 = glmmTMB(O2 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])
  
## QFT

AM_0 = glmmTMB(O2 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O2 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O2 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam = AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[1, ]


```

**%CD4+ totIFNg+**: 

```{r Outcome3, include=TRUE}
l = varA[3]
k = 3

# Fit models

AM_0 = glmmTMB(O3 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

AM_0 = glmmTMB(O3 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

##p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O3 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O3 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam = AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O = c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

##p_ave = (p1+p2+p3+p4)/4

```

**%CD4+ totIL2+**: Doesn't run Wald or profile CIs. Calculated confidence intervals manually.

```{r Outcome4, include=TRUE}
l = varA[4]
k = 4

# Fit models

AM_0 = glmmTMB(O4 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = data.frame("LowerCI" = fc1$Estimate - 1.96*fc1$Std..Error, "UpperCI" = fc1$Estimate + 1.96*fc1$Std..Error)
plc1 = sort_row_values(plc1)

fc1 = cbind(fc1, "LowerCI" = plc1[, 1], "UpperCI" = plc1[, 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O4 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = data.frame("LowerCI" = fc2$Estimate - 1.96*fc2$Std..Error, "UpperCI" = fc2$Estimate + 1.96*fc2$Std..Error)
plc2 = sort_row_values(plc2)

fc2 = cbind(fc2, "LowerCI" = plc2[, 1], "UpperCI" = plc2[, 2])
#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

##p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O4 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = data.frame("LowerCI" = fc3$Estimate - 1.96*fc3$Std..Error, "UpperCI" = fc3$Estimate + 1.96*fc3$Std..Error)
plc3 = sort_row_values(plc3)

fc3 = cbind(fc3, "LowerCI" = plc3[, 1], "UpperCI" = plc3[, 2])
#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O4 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = data.frame("LowerCI" = fc4$Estimate - 1.96*fc4$Std..Error, "UpperCI" = fc4$Estimate + 1.96*fc4$Std..Error)
plc4 = sort_row_values(plc4)

fc4 = cbind(fc4, "LowerCI" = plc4[, 1], "UpperCI" = plc4[, 2])
#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

##p4 = unname(family_params(AM_0)[1])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam = AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O = c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

#p_ave = (p1+p2+p3+p4)/4

```
**%CD4+ totIL17+:** 
```{r Outcome5, include=TRUE}
l = varA[5]
k = 5

AM_0 = glmmTMB(O5 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

AM_0 = glmmTMB(O5 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p2 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O5 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

##p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O5 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

##p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam = AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O = c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

```
**%CD4+ totIL22+**: 
```{r Outcome6, include=TRUE}
l = varA[6]
k = 6

# Fit models

AM_0 = glmmTMB(O6 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O6 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])


#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O6 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O6 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam = AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O = c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**%CD4+ totTNF+:** 
```{r Outcome 7, include = TRUE}
l = varA[7]
k = 7

# Fit models

AM_0 = glmmTMB(O7 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O7 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])


#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O7 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O7 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc3[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam = AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O = c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**%CD8+ totIFNg+:** Doesn't run on profile.

```{r Outcome8, include=TRUE}
l = varA[8]
k = 8

# Fit models

AM_0 = glmmTMB(O8 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

####p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O8 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p2 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O8 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

##p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O8 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

###p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam = AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O = c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**%CD8+ totIL2+:** 

```{r Outcome9, include=TRUE}
l = varA[9]
k = 9

# Fit models

AM_0 = glmmTMB(O9 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

#p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O9 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p2 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O9 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 = c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O9 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 = unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 = c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

###p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

```{r Outcome10, include=TRUE}

l = varA[10]
k = 10

AM_0 = glmmTMB(O10 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O10 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O10 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O10 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```


**%CD8+ totIL17+:** 

```{r Outcome11, include=TRUE}
l = varA[11]
k = 11

AM_0 = glmmTMB(O11 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O11 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O11 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O11 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**%CD8+ totIL22+:** 

```{r Outcome12, include=TRUE}
l = varA[12]
k = 12

AM_0 = glmmTMB(O12 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

AM_0 = glmmTMB(O12 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O12 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O12 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4


# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**%CD8+ totTNF+:** 

```{r Outcome13, include=TRUE}
l = varA[13]
k = 13

AM_0 = glmmTMB(O13 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O13 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O13 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O13 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave =  (p1+p2+p3+p4)/4


# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

```

**Bulk CD4+/% R7-RA+:** 

```{r Outcome14, include=TRUE}
l = varA[14]
k = 14

AM_0 = glmmTMB(O14 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O14 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O14 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O14 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0("BulkCD4R7nRAp_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]


```

**Bulk CD4+/% R7+RA+:** 

```{r Outcome15, include=TRUE}
l = varA[15]
k = 15

AM_0 = glmmTMB(94-O15 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(94-O15 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(94-O15 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(94 - O15 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = TRUE)
write_excel_csv(OR, file = "BulkCD4R7pRAp_Results.csv")

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave =  (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "Left skew corrected"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```
**Bulk CD4+/% R7+RA-:** 
```{r Outcome16, include=TRUE}
l = varA[16]
k = 16

AM_0 = glmmTMB(O16 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O16 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O16 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O16 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = "BulkCD4R7pRAn_Results.csv")

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
##resA[k,2:28] = O

#resA[k, ]
```

**Bulk CD4+/% R7-RA-:** 

```{r Outcome17, include=TRUE}
l = varA[17]
k = 17

AM_0 = glmmTMB(O17 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O17 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])


#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O17 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O17 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = "BulkCD4R7nRAn_Results.csv")


#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**Bulk CD8+/% R7-RA+**: 

```{r Outcome18, include=TRUE}
l = varA[18]
k = 18

# Fit models

AM_0 = glmmTMB(O18 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O18 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O18 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O18 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0("BulkCD8R7nRAp_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```


**Bulk CD8+/% R7+RA+:** 
```{r Outcome19, include=TRUE}
l = varA[19]
k = 19

# Fit models

AM_0 = glmmTMB(101 - O19 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

M_0 = glmmTMB(101 - O19 ~ Treatment*Time + Gender*Time + QFT + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)
#fc1 = cbind("Outcome" = paste0("101-",l), "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(101 - O19 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)
#fc2 = cbind("Outcome" = paste0("101-",l), "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])


#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(101 - O19 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

AM_0x = glmmTMB(101 - O19 ~ FA*Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0x = summary(AM_0x)

library(emmeans)

emmeans::emmeans(AM_0x, specs = c("FA", "Gender"))
emmeans::emmeans(AM_0x, pairwise ~ FA * Gender * Time, adjust = "none")

emmip(AM_0x, FA ~ Time | Gender)

emmeans::emmeans(AM_0x, pairwise ~ FA * Gender | Time, adjust = "none")


?emmeans

AM_0x = glmmTMB(101 - O19 ~ FA*Time + Gender*Time + Treatment + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0x = summary(AM_0x)

fc3 = data.frame(AS_0$coefficients$cond)
#fc3 = cbind("Outcome" = paste0("101-",l), "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(101 - O19 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

AM_0x = glmmTMB(101 - O19 ~ FA*Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0x = summary(AM_0x)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = TRUE)
write_excel_csv(OR, file = paste0("BulkCD8R7pRAp_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "Left skew corrected"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]


```
**Bulk CD8+/% R7+RA-:** 
```{r Outcome20, include=TRUE}
l = varA[20]
k = 20

# Fit models

AM_0 = glmmTMB(O20 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O20 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O20 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O20 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0("BulkCD8R7pRAn_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```
**Bulk CD8+/% R7-RA-:** 
```{r Outcome21, include=TRUE}
l = varA[21]
k = 21

# Fit models

AM_0 = glmmTMB(O21 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O21 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])


#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O21 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

#AM_0x = glmmTMB(O21 ~ FA*Time + Gender*Time + Treatment + (1| ID), data = groupA, family = Gamma(link = "log"))
#AS_0x = summary(AM_0x)

#AM_0xx = glmmTMB(O21 ~ FA*Time + Gender*Time + QFT + (1| ID), data = groupA, family = Gamma(link = "log"))
#AS_0xx = summary(AM_0xx)

#AM_0xxx = glmmTMB(O21 ~ FA*Time + Gender*Time + Treatment + QFT + (1| ID), data = groupA, family = Gamma(link = "log"))
#AS_0xxx = summary(AM_0xxx)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O21 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0("BulkCD8R7nRAn_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

```

**CD4 %Ki67+:** 

```{r Outcome22, include=TRUE}
l = varA[22]
k = 22

# Fit models

AM_0 = glmmTMB(O22 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O22 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

###p1 = unname(family_params(AM_0)[1])

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O22 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O22 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

```

**%CD8 %Ki67+:** 

```{r Outcome23, include=TRUE}
l = varA[23]
k = 23

# Fit models

AM_0 = glmmTMB(O23 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O23 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

AM_0X = glmmTMB(O23 ~ QFT*Time + Gender*Time + Treatment + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0X = summary(AM_0X)

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O23 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O23 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```



**Gd %Ki67+:** 

```{r Outcome24, include=TRUE}
l = varA[24]
k = 24

# Fit models

AM_0 = glmmTMB(O24 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O24 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O24 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O24 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

```

**NK %Ki67+:** 

```{r Outcome25, include=TRUE}
l = varA[25]
k = 25

# Fit models

AM_0 = glmmTMB(O25 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O25 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O25 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O25 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

```

**GrA+ %of Ki67+CD4:** 
```{r Outcome26, include=TRUE}
l = varA[26]
k = 26

# Fit models

AM_0 = glmmTMB(O26 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10), 1], "UpperCI" = plc1[-c(10), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

# Plot

AM_0 = glmmTMB(O26 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10), 1], "UpperCI" = plc2[-c(10), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O26 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16), 1], "UpperCI" = plc3[-c(16), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O26 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16), 1], "UpperCI" = plc4[-c(16), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrB+ %of Ki67+CD4:** 
```{r Outcome27, include=TRUE}
l = varA[27]
k = 27

# Fit models

AM_0 = glmmTMB(O27 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

###p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O27 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O27 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O27 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrK+ %of Ki67+CD4:** 

```{r Outcome29, include=TRUE}
l = varA[29]
k = 29

# Fit models

AM_0 = glmmTMB(O29 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O29 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O29 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O29 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**Perf+ %of Ki67+CD4:** 
```{r Outcome30, include=TRUE}
l = varA[30]
k = 30

# Fit models

AM_0 = glmmTMB(O30 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O30 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O30 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O30 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrA+ %of Ki67+ gd:** 
```{r Outcome31, include=TRUE}
l = varA[31]
k = 31

# Fit models

#hist(groupA$O31)

AM_0 = glmmTMB(O31 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10), 1], "UpperCI" = plc1[-c(10), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])


AM_0 = glmmTMB(O31 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O31 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O31 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p2+p3+p4)/3

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrB+ %of Ki67+ GD:** 

```{r Outcome32, include=TRUE}
l = varA[32]
k = 32

# Fit models

AM_0 = glmmTMB(O32 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O32 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O32 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O32 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrK+ %of Ki67+ gd:**  

```{r Outcome34, include=TRUE}
l = varA[34]
k = 34

# Fit models

AM_0 = glmmTMB(O34 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O34 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O34 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O34 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**Perf+ %of Ki67+ gd:**  

```{r Outcome35, include=TRUE}
l = varA[35]
k = 35

# Fit models

AM_0 = glmmTMB(O35 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O35 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O35 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O35 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrA+ %of Ki67+ NK:** 
```{r Outcome36, include=TRUE}
l = varA[36]
k = 36

# Fit models

AM_0 = glmmTMB(101 - O36 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

AM_0 = glmmTMB(101 - O36 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(101 - O36 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(101 - O36 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = TRUE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "Left skew corrected"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrB+ %of Ki67+ NK:** 

```{r Outcome37, include=TRUE}
l = varA[37]
k = 37

# Fit models

AM_0 = glmmTMB(101 - O37 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(101 - O37 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(101 - O37 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(101 - O37 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = TRUE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "Left skew corrected"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

**GrK+ %of Ki67+ NK:** 

```{r Outcome39, include=TRUE}
l = varA[39]
k = 39

# Fit models

AM_0 = glmmTMB(O39 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-c(10,11), 1], "UpperCI" = plc1[-c(10,11), 2])


#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(O39 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-c(10,11), 1], "UpperCI" = plc2[-c(10,11), 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O39 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-c(16,17), 1], "UpperCI" = plc3[-c(16, 17), 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O39 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-c(16,17), 1], "UpperCI" = plc4[-c(16,17), 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]

```

**Perf+ %of Ki67+ NK:** 

```{r Outcome40, include=TRUE}
l = varA[40]
k = 40

# Fit models

AM_0 = glmmTMB(100 - O40 ~ Treatment*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-10, 1], "UpperCI" = plc1[-10, 2])

#c1 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c1 = c(c1[1, ], c1[2, ])

##p1 = unname(family_params(AM_0)[1])

# Plot

AM_0 = glmmTMB(100 - O40 ~ QFT*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-10, 1], "UpperCI" = plc2[-10, 2])

#c2 = unname(AS_0$coefficients$cond[6:7, -c(3, 4)])
#c2 = c(c2[1, ], c2[2, ])

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(100 - O40 ~ FA*Time + Gender*Time + (1| ID), data = groupA, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-16, 1], "UpperCI" = plc3[-16, 2])

#c3 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c3 =  c(c3[1, ], c3[3, ], c3[4, ], c3[6, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(100 - O40 ~ FA*Time + Gender*Time + (1| ID), data = groupAre1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-16, 1], "UpperCI" = plc4[-16, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "A", "Reflected" = TRUE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[8:13, -c(3, 4)])
#c4 =  c(c4[1, ], c4[3, ], c4[4, ], c4[6, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "Left skew corrected"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)
#resA[k,2:28] = O

#resA[k, ]
```

```{r writedat, include =FALSE}
#write_excel_csv(resA, file = "GroupAResults.csv")
```

**Baby Anti-BCG IgG (AUC)**:

```{r Outcome2, include=TRUE}
l = varB[4]
k = 4

# Fit models

AM_0 = glmmTMB(O4 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB1,
               family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-7, 1], "UpperCI" = plc1[-7, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O4 ~ QFT*Time + Gender*Time + (1| ID), data = groupB1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-7, 1], "UpperCI" = plc2[-7, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O4 ~ FA*Time + Gender*Time + (1| ID), data = groupB1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-11, 1], "UpperCI" = plc3[-11, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O4 ~ FA*Time + Gender*Time + (1| ID), data = groupB1re1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-11, 1], "UpperCI" = plc4[-11, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =   unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#resB[k,2:16] = O

#resB[k, ]


```

**Baby Anti-BCG IgM (AUC)**:

```{r Outcome5B, include=TRUE}
l = varB[5]
k = 5

# Fit models

AM_0 = glmmTMB(O5 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB1,
               family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-7, 1], "UpperCI" = plc1[-7, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O5 ~ QFT*Time + Gender*Time + (1| ID), data = groupB1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-7, 1], "UpperCI" = plc2[-7, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O5 ~ FA*Time + Gender*Time + (1| ID), data = groupB1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-11, 1], "UpperCI" = plc3[-11, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O5 ~ FA*Time + Gender*Time + (1| ID), data = groupB1re1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-11, 1], "UpperCI" = plc4[-11, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#resB[k,2:16] = O

#resB[k, ]


```

**Baby Anti-BCG IgM (AUC)**:

```{r Outcome5B, include=TRUE}
l = varB[6]
k = 6

# Fit models

AM_0 = glmmTMB(O6 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB1,
               family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-7, 1], "UpperCI" = plc1[-7, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O6 ~ QFT*Time + Gender*Time + (1| ID), data = groupB1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-7, 1], "UpperCI" = plc2[-7, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O6 ~ FA*Time + Gender*Time + (1| ID), data = groupB1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-11, 1], "UpperCI" = plc3[-11, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O6 ~ FA*Time + Gender*Time + (1| ID), data = groupB1re1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-11, 1], "UpperCI" = plc4[-11, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#resB[k,2:16] = O

#resB[k, ]


```

**Elispot IFNg (BCG)**:

```{r Outcome7B, include=TRUE}
l = varB[7]
k = 7

# Fit models

AM_0 = glmmTMB(O7 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB1,
               family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-7, 1], "UpperCI" = plc1[-7, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O7 ~ QFT*Time + Gender*Time + (1| ID), data = groupB1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-7, 1], "UpperCI" = plc2[-7, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O7 ~ FA*Time + Gender*Time + (1| ID), data = groupB1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-11, 1], "UpperCI" = plc3[-11, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O7 ~ FA*Time + Gender*Time + (1| ID), data = groupB1re1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-11, 1], "UpperCI" = plc4[-11, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#resB[k,2:16] = O

#resB[k, ]


```


**%CD16 ppPMN**:

```{r Outcome5B, include=TRUE}
l = varB[8]
k = 8

# Fit models

AM_0 = glmmTMB(O8 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O8 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O8 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

AM_0X = glmmTMB(O8 ~ FA*Time + Gender*Time + QFT + (1| ID), data = groupB2, family = nbinom1(link = "log"))
AS_0X = summary(AM_0X)

AM_0X = glmmTMB(O8 ~ FA*Gender*Time + (1| ID), data = groupB2, family = nbinom1(link = "log"))
AS_0X = summary(AM_0X)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O8 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = nbinom1(link = "log"))
AS_0 = summary(AM_0)

AM_0X = glmmTMB(O8 ~ FA*Time + Gender*Time + QFT + (1| ID), data = groupB2re1, family = nbinom1(link = "log"))
AS_0X = summary(AM_0X)

AM_0X = glmmTMB(O8 ~ FA*Gender*Time + (1| ID), data = groupB2re1, family = nbinom1(link = "log"))
AS_0X = summary(AM_0X)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))


#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]


```

**%CD14 pMono**:

```{r Outcome5B, include=TRUE}
l = varB[9]
k = 9

# Fit models

AM_0 = glmmTMB(O9 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

##p1 = unname(family_params(AM_0)[1])

AM_0 = glmmTMB(O9 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O9 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O9 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4


# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]


```

**%CD19 pB**:

```{r Outcome5B, include=TRUE}
l = varB[10]
k = 10

# Fit models

AM_0 = glmmTMB(O10 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

##p1 = unname(family_params(AM_0)[1])

AM_0 = glmmTMB(O10 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O10 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])


#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O10 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))


#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

#p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]


```

**%CD3 pT**:

```{r Outcome5B, include=TRUE}
l = varB[11]
k = 11

# Fit models

AM_0 = glmmTMB(O11 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = poisson(link = "log"))
AS_0 = summary(AM_0)

head(groupB2)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O11 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O11 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O11 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]

table(groupA$Feeding, groupA$Gender)
table(groupB$Feeding, groupB$Gender)

#Elispot, CD4 total inf-g - in common

```

**%CD56+ NKTlike**:

```{r Outcome5B, include=TRUE}
l = varB[12]
k = 12

# Fit models

AM_0 = glmmTMB(O12 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O12 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O12 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O12 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]


```

**%CD8+ T**:

```{r }
l = varB[13]
k = 13

# Fit models

AM_0 = glmmTMB(O13 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O13 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O13 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O13 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

##O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]


```


**%HLADRp CD8 T**:

```{r }
l = varB[14]
k = 14

# Fit models

AM_0 = glmmTMB(O14 ~ Treatment*Time + Gender*Time + (Time| ID), data = groupB2,
               family = t_family(link = "log"))
AS_0 = summary(AM_0)

emmeans(AM_0, pairwise~Treatment * Time, adjust = "none")

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O14 ~ QFT*Time + Gender*Time + (Time| ID), data = groupB2, family = t_family(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O14 ~ FA*Time + Gender*Time + (Time| ID), data = groupB2, family = t_family(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =   unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O14 ~ FA*Time + Gender*Time + (Time| ID), data = groupB2re1, family = gaussian(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]


```

**%CD4p T**:

```{r, }
l = varB[15]
k = 15

# Fit models

AM_0 = glmmTMB(O15 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = #c1[1, ]

AM_0 = glmmTMB(O15 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = poisson(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O15 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = poisson(link = "log"))
AS_0 = summary(AM_0)

AM_0x = glmmTMB(O15 ~ FA*Gender*Time + (1| ID), data = groupB2, family = poisson(link = "log"))
AS_0x = summary(AM_0x)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O15 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = poisson(link = "log"))
AS_0 = summary(AM_0)

AM_0x = glmmTMB(O15 ~ FA*Gender*Time + (1| ID), data = groupB2re1, family = poisson(link = "log"))
AS_0x = summary(AM_0x)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]


```

**%HLADRp CD4 T**:

```{r }
l = varB[16]
k = 16

# Fit models

AM_0 = glmmTMB(O16 ~ Treatment*Time + Gender*Time + (Time| ID), data = groupB2,
               family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])


#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O16 ~ QFT*Time + Gender*Time + (Time| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O16 ~ FA*Time + Gender*Time + (Time| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O16 ~ FA*Time + Gender*Time + (Time| ID), data = groupB2re1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]

```

**%GDtcrP**:

```{r }
l = varB[17]
k = 17

# Fit models

AM_0 = glmmTMB(O17 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-7, 1], "UpperCI" = plc1[-7, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

##p1 = unname(family_params(AM_0)[1])

AM_0 = glmmTMB(O17 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-7, 1], "UpperCI" = plc2[-7, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

#p1 = unname(family_params(AM_0)[1])

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O17 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-11, 1], "UpperCI" = plc3[-11, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

#p3 = unname(family_params(AM_0)[1])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O17 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = tweedie(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-11, 1], "UpperCI" = plc4[-11, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))


#c4 = unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 = c(c4[3, ], c4[1, ])

##p4 = unname(family_params(AM_0)[1])

#p_ave = (p1+p2+p3+p4)/4

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

##O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]

```

**%HLADRp gd T**:

```{r }
l = varB[18]
k = 18

# Fit models

AM_0 = glmmTMB(O18 ~ Treatment*Time + Gender*Time + (Time| ID), data = groupB2,
               family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[1:6, 1], "UpperCI" = plc1[1:6, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O18 ~ QFT*Time + Gender*Time + (Time| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[1:6, 1], "UpperCI" = plc2[1:6, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O18 ~ FA*Time + Gender*Time + (Time| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[1:10, 1], "UpperCI" = plc3[1:10, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O18 ~ FA*Time + Gender*Time + (Time| ID), data = groupB2re1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[1:10, 1], "UpperCI" = plc4[1:10, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))

#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]

```

**%totNK**:

```{r }
l = varB[19]
k = 19

# Fit models

AM_0 = glmmTMB(O19 ~ Treatment*Time + Gender*Time + (1| ID), data = groupB2,
               family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc1 = data.frame(AS_0$coefficients$cond)
fc1 = cbind("Outcome" = l, "Group" = "MVA85A", "Coefficient" = row.names(AS_0$coefficients$cond), fc1)

plc1 = confint(AM_0, method = "wald", component = "cond")
fc1 = cbind(fc1, "LowerCI" = plc1[-7, 1], "UpperCI" = plc1[-7, 2])

#c1 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c1 = c1[1, ]

AM_0 = glmmTMB(O19 ~ QFT*Time + Gender*Time + (1| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc2 = data.frame(AS_0$coefficients$cond)
fc2 = cbind("Outcome" = l, "Group" = "QFT", "Coefficient" = row.names(AS_0$coefficients$cond), fc2)

plc2 = confint(AM_0, method = "wald", component = "cond")
fc2 = cbind(fc2, "LowerCI" = plc2[-7, 1], "UpperCI" = plc2[-7, 2])

#c2 = unname(AS_0$coefficients$cond[5:6, -c(3, 4)])
#c2 = c2[1, ]

# Formula, antibiotic is ref for breastfeeding, antibiotic (3)
# Formula, antibiotic is ref for formula, no antibiotic (1)

AM_0 = glmmTMB(O19 ~ FA*Time + Gender*Time + (1| ID), data = groupB2, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc3 = data.frame(AS_0$coefficients$cond)
fc3 = cbind("Outcome" = l, "Group" = "FA - FA", "Coefficient" = row.names(AS_0$coefficients$cond), fc3)

plc3 = confint(AM_0, method = "wald", component = "cond")
fc3 = cbind(fc3, "LowerCI" = plc3[-11, 1], "UpperCI" = plc3[-11, 2])

#c3 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c3 =  c(c3[3, ], c3[1, ])

# Breastfeeding, antibiotic is ref for breastfeeding, no antibiotic (2)
# Breastfeeding, antibiotic is ref for formula, antibiotic (0)

AM_0 = glmmTMB(O19 ~ FA*Time + Gender*Time + (1| ID), data = groupB2re1, family = Gamma(link = "log"))
AS_0 = summary(AM_0)

fc4 = data.frame(AS_0$coefficients$cond)
fc4 = cbind("Outcome" = l, "Group" = "FA - BA", "Coefficient" = row.names(AS_0$coefficients$cond), fc4)

plc4 = confint(AM_0, method = "wald", component = "cond")
fc4 = cbind(fc4, "LowerCI" = plc4[-11, 1], "UpperCI" = plc4[-11, 2])

# Put all results together
OR = rbind(fc1, fc2, fc3, fc4)
OR = cbind(OR, "Arm" = "B", "Reflected" = FALSE)
write_excel_csv(OR, file = paste0(l, "_Results.csv"))


#c4 =  unname(AS_0$coefficients$cond[7:10, -c(3, 4)])
#c4 =  c(c4[3, ], c4[1, ])

# Extract coefficient estimates, standard errors, test statistic, random effect SD, residual SD

#tran = "None"
#fam =AM_0$modelInfo$family$family
#lin = AM_0$modelInfo$family$link

# Create a string
    ## Family, Link, Beta, SE, Test Stat, Cov, SE, Test Stat, Int, SE, Test Stat, Ranef, Resid, Index, Disp

#O =  c(tran, fam, lin, c1, c2, c3, c4)

#length(O)

#resB[k,2:16] = O

#resB[k, ]

```

```{r writedat, include =FALSE}
#write_excel_csv(resB, file = "GroupBResults.csv")
```
